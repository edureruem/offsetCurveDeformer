// offsetCurveDeformer 노드 테스트 MEL 스크립트
// Maya 2020에서 실행하여 노드 기능을 테스트합니다.

global proc testOffsetCurveDeformer()
{
    print("=== offsetCurveDeformer 노드 테스트 시작 ===\n");
    
    // 1. 테스트용 커브 생성
    print("1. 테스트용 NURBS 커브 생성...\n");
    string $testCurve = `circle -radius 5 -sections 8 -name "testCurve"`;
    print("   생성된 커브: " + $testCurve[0] + "\n");
    
    // 2. offsetCurveDeformer 노드 생성
    print("2. offsetCurveDeformer 노드 생성...\n");
    string $deformerNode = `deformer -type "offsetCurveDeformerPatent" $testCurve[0]`;
    print("   생성된 디포머: " + $deformerNode[0] + "\n");
    
    // 3. 노드 속성 확인
    print("3. 노드 속성 확인...\n");
    string $attributes[] = `listAttr -keyable $deformerNode[0]`;
    print("   키프레임 가능한 속성들: " + stringArrayToString($attributes, ", ") + "\n");
    
    // 4. 기본 속성 값 설정
    print("4. 기본 속성 값 설정...\n");
    setAttr ($deformerNode[0] + ".offsetMode") 0;  // Normal 모드
    setAttr ($deformerNode[0] + ".implementationType") 0;  // B-Spline
    setAttr ($deformerNode[0] + ".falloffRadius") 2.0;
    setAttr ($deformerNode[0] + ".normalOffset") 1.0;
    setAttr ($deformerNode[0] + ".debugDisplay") 1;
    print("   기본 속성 설정 완료\n");
    
    // 5. 영향 커브 생성 및 연결
    print("5. 영향 커브 생성 및 연결...\n");
    string $influenceCurve = `circle -radius 3 -sections 6 -name "influenceCurve"`;
    connectAttr ($influenceCurve[0] + ".worldSpace[0]") ($deformerNode[0] + ".influenceCurve[0]");
    print("   영향 커브 연결: " + $influenceCurve[0] + " -> " + $deformerNode[0] + "\n");
    
    // 6. 변형 테스트
    print("6. 변형 테스트...\n");
    move -relative 2 0 0 $influenceCurve[0];
    print("   영향 커브 이동 완료\n");
    
    // 7. 속성 애니메이션 테스트
    print("7. 속성 애니메이션 테스트...\n");
    setKeyframe -time 1 -value 0.0 ($deformerNode[0] + ".normalOffset");
    setKeyframe -time 24 -value 2.0 ($deformerNode[0] + ".normalOffset");
    print("   normalOffset 키프레임 설정 완료 (프레임 1-24)\n");
    
    // 8. 결과 확인
    print("8. 결과 확인...\n");
    print("   테스트 커브: " + $testCurve[0] + "\n");
    print("   디포머 노드: " + $deformerNode[0] + "\n");
    print("   영향 커브: " + $influenceCurve[0] + "\n");
    
    print("=== 테스트 완료 ===\n");
    print("Maya 뷰포트에서 변형 효과를 확인하세요.\n");
    print("타임라인을 1-24 프레임으로 이동하여 애니메이션을 확인하세요.\n");
}

global proc testAdvancedFeatures()
{
    print("=== 고급 기능 테스트 시작 ===\n");
    
    // 기존 노드 찾기
    string $deformerNodes[] = `ls -type "offsetCurveDeformerPatent"`;
    if (size($deformerNodes) == 0)
    {
        print("offsetCurveDeformer 노드를 먼저 생성해주세요.\n");
        return;
    }
    
    string $deformerNode = $deformerNodes[0];
    print("테스트 대상 노드: " + $deformerNode + "\n");
    
    // 1. 다양한 오프셋 모드 테스트
    print("1. 다양한 오프셋 모드 테스트...\n");
    string $modes[] = {"Normal", "Tangent", "BiNormal"};
    for ($i = 0; $i < size($modes); $i++)
    {
        setAttr ($deformerNode + ".offsetMode") $i;
        print("   " + $modes[$i] + " 모드 설정 완료\n");
    }
    
    // 2. 구현 타입 변경 테스트
    print("2. 구현 타입 변경 테스트...\n");
    setAttr ($deformerNode + ".implementationType") 1;  // Arc Segment
    print("   Arc Segment 모드로 변경\n");
    
    // 3. 고급 제어 속성 테스트
    print("3. 고급 제어 속성 테스트...\n");
    setAttr ($deformerNode + ".volumePreservation") 0.8;
    setAttr ($deformerNode + ".selfIntersectionPrevention") 0;
    setAttr ($deformerNode + ".poseSpaceBlending") 0.5;
    print("   고급 속성 설정 완료\n");
    
    print("=== 고급 기능 테스트 완료 ===\n");
}

global proc cleanupTest()
{
    print("=== 테스트 데이터 정리 ===\n");
    
    // 테스트로 생성된 오브젝트들 삭제
    string $testObjects[] = {"testCurve", "influenceCurve"};
    for ($obj in $testObjects)
    {
        if (`objExists $obj`)
        {
            delete $obj;
            print("   " + $obj + " 삭제 완료\n");
        }
    }
    
    // 디포머 노드들 삭제
    string $deformerNodes[] = `ls -type "offsetCurveDeformerPatent"`;
    for ($node in $deformerNodes)
    {
        delete $node;
        print("   " + $node + " 삭제 완료\n");
    }
    
    print("   정리 완료\n");
}

// 사용법 안내
print("offsetCurveDeformer 노드 테스트 MEL 스크립트\n");
print("사용 가능한 함수들:\n");
print("  testOffsetCurveDeformer() - 기본 기능 테스트\n");
print("  testAdvancedFeatures() - 고급 기능 테스트\n");
print("  cleanupTest() - 테스트 데이터 정리\n");
print("=" * 50 + "\n");
